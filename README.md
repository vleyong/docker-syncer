# ğŸ³ Docker Image Syncer (é•œåƒæ¬è¿å·¥)

åˆ©ç”¨ GitHub Actions çš„å…è´¹ç®—åŠ›å’Œé«˜é€Ÿç½‘ç»œï¼Œå°† DockerHub çš„é•œåƒæ¬è¿åˆ° **é˜¿é‡Œäº‘å®¹å™¨é•œåƒæœåŠ¡ (ACR)** æˆ– **GitHub Packages (GHCR)**ã€‚

**âœ¨ æ ¸å¿ƒä¼˜åŠ¿ (Proç‰ˆ):**

1. **å¤šæ¶æ„æ”¯æŒ**ï¼šæ”¯æŒæŒ‡å®š `--platform` (å¦‚ `linux/arm64`)ï¼Œå®Œç¾é€‚é…æ ‘è“æ´¾ã€M1/M2 Mac ç­‰è®¾å¤‡ã€‚
2. **æ¶æ„æ„ŸçŸ¥æ™ºèƒ½åŒæ­¥**ï¼š
*
* è§£å†³å®˜æ–¹é•œåƒï¼ˆå¦‚ `mysql:8.0`ï¼‰æ˜¯ Manifest List å¯¼è‡´çš„è¯¯åˆ¤é—®é¢˜ã€‚è„šæœ¬ä¼šç²¾å‡†æ¯”å¯¹**ç‰¹å®šæ¶æ„**çš„æ‘˜è¦ (Digest)ï¼ŒçœŸæ­£å®ç°â€œå†…å®¹ä¸å˜åˆ™è·³è¿‡â€ã€‚
* **åŒé‡æ ¡éªŒæœºåˆ¶**ï¼šä¸ä»…æ¯”å¯¹æ‘˜è¦ (Digest)ï¼Œè¿˜ä¼šæ¯”å¯¹é•œåƒåˆ›å»ºæ—¶é—´ (Created)ã€‚å³ä½¿ Registry å¯èƒ½ä¼šä¿®æ”¹é•œåƒå‹ç¼©æ–¹å¼å¯¼è‡´æ‘˜è¦æ”¹å˜ï¼Œåªè¦åˆ›å»ºæ—¶é—´ä¸€è‡´ï¼Œä¾ç„¶åˆ¤å®šä¸ºåŒæºï¼Œé˜²æ­¢æ­»å¾ªç¯é‡å¤æ¨é€ã€‚


3. **æè‡´ç©ºé—´ä¼˜åŒ–**ï¼š
* æ„å»ºå‰è‡ªåŠ¨æ¸…ç† .NET/Android ç­‰ 10GB+ æ— ç”¨ç¯å¢ƒã€‚
* **å³ä¸‹å³åˆ **ï¼šæ¨é€å®Œä¸€ä¸ªé•œåƒç«‹å³æ¸…ç†ï¼Œæ”¯æŒå¤§æ‰¹é‡ã€å¤§ä½“ç§¯é•œåƒåŒæ­¥ï¼Œé˜²æ­¢ Runner ç£ç›˜çˆ†æ»¡ã€‚


4. **æ™ºèƒ½å‘½åç­–ç•¥**ï¼š
* è‡ªåŠ¨å¤„ç†å‘½åç©ºé—´å†²çªï¼ˆå¦‚ `bitnami/nginx` -> `bitnami_nginx`ï¼‰ã€‚
* è‡ªåŠ¨é€‚é… GHCR çš„å°å†™å‘½åè¦æ±‚ã€‚



---

![Last Sync](https://img.shields.io/badge/last%20sync-2026--01--02%2004:49:39-green)

## âš¡ å¿«é€Ÿå¼€å§‹ (Quick Start)

1. ç‚¹å‡»ä»“åº“å³ä¸Šè§’çš„ **[Use this template]** æŒ‰é’®ï¼Œé€‰æ‹© **Create a new repository**ã€‚
2. è¾“å…¥ä»“åº“åç§°ï¼Œå»ºè®®è®¾ä¸º **Public** (Public ä»“åº“ä½¿ç”¨ GHCR å­˜å‚¨ç©ºé—´æ— é™åˆ¶)ã€‚
3. æŒ‰ç…§ä¸‹æ–¹ [é…ç½® Secrets](https://www.google.com/search?q=%23%EF%B8%8F-%E9%85%8D%E7%BD%AE-secrets) å®Œæˆè®¾ç½®ã€‚
4. è‡ªåŠ¨æ“ä½œï¼ˆè§ä½¿ç”¨æŒ‡å—ï¼‰æˆ–æ‰‹åŠ¨æ“ä½œæ­¥éª¤ï¼š
  * ç‚¹å‡» Actions é¡µé¢ -> é€‰æ‹©å¯¹åº”å·¥ä½œæµã€‚
  * ç‚¹å‡» **Run workflow**ã€‚
  * è¾“å…¥å‚æ•°ï¼š
     * `image_name`: åŸé•œåƒå (å¦‚ `gitea/gitea:1.20`)
     * `new_name` (ä»…Aliyun) / `target_name` (ä»…GHCR): (å¯é€‰) é‡å‘½åç›®æ ‡é•œåƒ
     * `platform`: (å¯é€‰) æŒ‡å®šæ¶æ„
     * `force_sync`: (å¯é€‰) å¼ºåˆ¶åŒæ­¥
---

## ğŸ› ï¸ é…ç½® Secrets

è¿›å…¥ä»“åº“çš„ **Settings** -> **Secrets and variables** -> **Actions** -> **New repository secret**ï¼š

| Secret Name | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹ |
| --- | --- | --- | --- |
| `ALIYUN_REGISTRY` | âœ… | é˜¿é‡Œäº‘ ACR å…¬ç½‘åœ°å€ | `registry.cn-hangzhou.aliyuncs.com` |
| `ALIYUN_NAMESPACE` | âœ… | ä½ çš„å‘½åç©ºé—´ | `develata` |
| `ALIYUN_USERNAME` | âœ… | é˜¿é‡Œäº‘ç™»å½•è´¦å· | `username@123.onaliyun.com` |
| `ALIYUN_PASSWORD` | âœ… | é˜¿é‡Œäº‘ **è®¿é—®å‡­è¯å¯†ç ** | `Mypassword123` |
| `DOCKERHUB_USERNAME` | âŒ | DockerHub ç”¨æˆ·å (æ¨èé…ç½®ï¼Œé˜²é™æµ) | `myuser` |
| `DOCKERHUB_TOKEN` | âŒ | DockerHub Token (æ¨èé…ç½®) | `dckr_pat_xxx` |
| `WEBHOOK_URL` | âŒ | æ¶ˆæ¯é€šçŸ¥ webhook åœ°å€ (é£ä¹¦/é’‰é’‰) | `https://open.feishu.cn/...` |

> **æç¤º**ï¼šGHCR æ— éœ€é…ç½® Secretï¼Œè„šæœ¬é»˜è®¤ä½¿ç”¨ `${{ secrets.GITHUB_TOKEN }}` é‰´æƒã€‚

### ğŸ”” æ¶ˆæ¯é€šçŸ¥ (Notifications)

å¦‚æœé…ç½®äº† `WEBHOOK_URL`ï¼Œä»»åŠ¡ç»“æŸæ—¶ï¼ˆæˆåŠŸæˆ–å¤±è´¥ï¼‰ä¼šå‘é€ JSON é€šçŸ¥ã€‚
æ”¯æŒ **é£ä¹¦ (Feishu/Lark)**ã€**é’‰é’‰ (DingTalk)** ç­‰å¹³å°ã€‚

---

## ğŸš€ ä½¿ç”¨æŒ‡å— (Usage)

æœ¬é¡¹ç›®æä¾› **4 ç§** å¼ºå¤§çš„å·¥ä½œæµï¼Œæ»¡è¶³ä¸åŒåœºæ™¯éœ€æ±‚ï¼š

### 1. è‡ªåŠ¨æ‰¹é‡åŒæ­¥ (`sync-batch-daily.yml`)

é€‚åˆå®šæœŸåŒæ­¥å¤§é‡é•œåƒã€‚

* **è§¦å‘æ–¹å¼**ï¼š
  * **Push è§¦å‘**ï¼šä¿®æ”¹å¹¶æäº¤ `images.txt` æ–‡ä»¶æ—¶è‡ªåŠ¨è¿è¡Œã€‚
  * **å®šæ—¶è§¦å‘**ï¼šæ¯å¤©/æ¯å‘¨å®šæ—¶è¿è¡Œã€‚
  * **æ‰‹åŠ¨è§¦å‘**ï¼šç‚¹å‡» Run workflow æ‰‹åŠ¨è¿è¡Œã€‚
* **æ‰‹åŠ¨è§¦å‘å‚æ•°**ï¼š
  * `force_sync`: (å¯é€‰) å‹¾é€‰åˆ™è·³è¿‡æ‘˜è¦æ¯”å¯¹ï¼Œå¼ºåˆ¶åŒæ­¥æ‰€æœ‰é•œåƒã€‚
* **é…ç½®æ–¹å¼**ï¼šä¿®æ”¹ä»“åº“æ ¹ç›®å½•çš„ `images.txt`ã€‚

**`images.txt` è¯­æ³•ç¤ºä¾‹ï¼š**

```text
# åŸºç¡€é•œåƒ (é»˜è®¤ amd64)
nginx:alpine

# æŒ‡å®šæ¶æ„ (åŒæ­¥ arm64 ç‰ˆæœ¬)
--platform=linux/arm64 mysql:8.0

# åŒ…å«å‘½åç©ºé—´çš„é•œåƒ (è‡ªåŠ¨è½¬å­˜ä¸º bitnami_redis:latest)
bitnami/redis:latest

# æ”¯æŒç©ºè¡Œå’Œ # æ³¨é‡Š

```

### 2. åŒé‡åŒæ­¥ (`02. åŒé‡åŒæ­¥`)

**æœ€å¼ºæ¨¡å¼**ã€‚åŒæ—¶æ£€æŸ¥é˜¿é‡Œäº‘å’Œ GHCRã€‚

* **é€»è¾‘**ï¼šæº vs é˜¿é‡Œ vs GHCR ä¸‰æ–¹æ¯”å¯¹ã€‚
* **æ•ˆæœ**ï¼šå¦‚æœé˜¿é‡Œäº‘æœ‰äº†ä½† GHCR æ²¡æœ‰ï¼Œåªæ¨ GHCRï¼›å…¨éƒ½æœ‰åˆ™å…¨è·³è¿‡ã€‚
* **è¾“å…¥å‚æ•°**ï¼š
* `image_name`: åŸé•œåƒå (å¦‚ `python:3.9`)
* `target_name`: (å¯é€‰) è‡ªå®šä¹‰ç›®æ ‡åç§° (å¦‚ `my-python`)
* `platform`: (å¯é€‰) å¦‚ `linux/arm64`
* `force_sync`: (å¯é€‰) å‹¾é€‰åˆ™å¼ºåˆ¶è¦†ç›–



### 3. å•å‘åŒæ­¥ (`03. å•é¡¹åŒæ­¥` / `04. å•é¡¹åŒæ­¥`)

é€‚åˆä¸´æ—¶æ¬è¿å•ä¸ªé•œåƒåˆ°æŒ‡å®šä»“åº“ã€‚

* **æ“ä½œæ­¥éª¤**ï¼š
  1. ç‚¹å‡» Actions é¡µé¢ -> é€‰æ‹©å¯¹åº”å·¥ä½œæµã€‚
  2. ç‚¹å‡» **Run workflow**ã€‚
  3. è¾“å…¥å‚æ•°ï¼š
     * `image_name`: åŸé•œåƒå (å¦‚ `gitea/gitea:1.20`)
     * `new_name` (ä»…Aliyun) / `target_name` (ä»…GHCR): (å¯é€‰) é‡å‘½åç›®æ ‡é•œåƒ
     * `platform`: (å¯é€‰) æŒ‡å®šæ¶æ„
     * `force_sync`: (å¯é€‰) å¼ºåˆ¶åŒæ­¥



---

## ğŸ“¥ æ‹‰å–é•œåƒ (Pull)

åŒæ­¥å®Œæˆåï¼ŒæŸ¥çœ‹ Actions æ—¥å¿—è·å–æ‹‰å–åœ°å€ï¼Œæˆ–å‚è€ƒä»¥ä¸‹è§„åˆ™ï¼š

#### é»˜è®¤æƒ…å†µ (amd64)

```bash
# åŸå›¾: nginx:latest
docker pull registry.cn-hangzhou.aliyuncs.com/<ä½ çš„å‘½åç©ºé—´>/nginx:latest

```

#### å‘½åç©ºé—´å¤„ç†

```bash
# åŸå›¾: bitnami/redis:latest
docker pull registry.cn-hangzhou.aliyuncs.com/<ä½ çš„å‘½åç©ºé—´>/bitnami_redis:latest

```

#### å¤šæ¶æ„å¤„ç† (--platform=linux/arm64)

```bash
# åŸå›¾: mysql:8.0 (æŒ‡å®š arm64)
# è„šæœ¬ä¼šè‡ªåŠ¨åŠ ä¸Šæ¶æ„å‰ç¼€ï¼Œé˜²æ­¢è¦†ç›–
docker pull registry.cn-hangzhou.aliyuncs.com/<ä½ çš„å‘½åç©ºé—´>/linux_arm64_mysql:8.0

```

---

## â“ å¸¸è§é—®é¢˜ (FAQ)

### Q: ä¸ºä»€ä¹ˆè¦æŒ‡å®š `--platform`ï¼Ÿ

**A**:

1. **éœ€æ±‚å±‚é¢**ï¼šå¦‚æœä½ æ˜¯ç”¨ M1/M2 Mac æˆ–è€…æ ‘è“æ´¾ï¼Œå¿…é¡»æ‹‰å– `arm64` æ¶æ„çš„é•œåƒæ‰èƒ½è¿è¡Œã€‚
2. **æŠ€æœ¯å±‚é¢**ï¼šå®˜æ–¹é•œåƒï¼ˆå¦‚ MySQLï¼‰é€šå¸¸æ˜¯ä¸€ä¸ªåˆ—è¡¨ã€‚å¦‚æœä¸æŒ‡å®šæ¶æ„ï¼ŒSkopeo è·å–çš„æ˜¯åˆ—è¡¨æ‘˜è¦ï¼Œè€Œ Docker æ‹‰å–çš„æ˜¯å…·ä½“é•œåƒæ‘˜è¦ï¼Œä¸¤è€…ä¸ä¸€è‡´ä¼šå¯¼è‡´è„šæœ¬è®¤ä¸ºâ€œé•œåƒæœ‰æ›´æ–°â€ï¼Œä»è€Œæ— æ³•è·³è¿‡ï¼Œæµªè´¹èµ„æºã€‚

### Q: GHCR ä¸ºä»€ä¹ˆæ‹‰å–å¤±è´¥ï¼Ÿ

**A**:

1. ç¡®ä¿ä½ åœ¨ GitHub ä¸ªäººè®¾ç½®ä¸­æ‰“å¼€äº† Packages æƒé™ã€‚
2. å¦‚æœä»“åº“æ˜¯ **Private** çš„ï¼Œä½ éœ€è¦ç”¨ Token ç™»å½• Docker æ‰èƒ½æ‹‰å–ã€‚**å»ºè®®å°†æœ¬ä»“åº“è®¾ä¸º Public**ï¼Œè¿™æ ·ç”Ÿæˆçš„åŒ…ä¹Ÿæ˜¯ Public çš„ï¼Œå¯ä»¥å…ç™»å½•æ‹‰å–ã€‚

---

## ğŸ“œ License

MIT License. ä»…ä¾›ä¸ªäººå­¦ä¹ ä¸æŠ€æœ¯äº¤æµä½¿ç”¨ã€‚
